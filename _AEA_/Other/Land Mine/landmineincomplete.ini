[core]
copyFrom: ROOT:effects.template
name: landmine
class: CustomUnitMetadata
price: 800
maxHp: 10
mass: 3000
displayText: Landmine
displayDescription: - Small Activation Range (Small Ring) \n- Can be Disarmed by Enemy Engineers (Middle Ring) \n- Remote Detonation From Engineers (Large Ring) \n- Does 500 damage (AOE) \n- Cannot be attacked
displayText_ru: Мина
displayDescription_ru: - Маленький радиус для активации \n - Может быть обезврежена вражескими инженерами \n - Наносит урон по большой площади \n - Не может быть атакована.
displayText_zh: 地雷
displayDescription_zh: -小范围内激活\n-可以被敌方工程师单位解除\n-可以被己方工程师远程引爆\n-造成500点伤害（AOE）\n-无法被瞄准攻击

canNotBeDirectlyAttacked:true
techLevel: 1
buildSpeed: 30s
#availableInDemo: true

transportSlotsNeeded: 9999
tags: land_mines, lds, mineOn
fogOfWarSightRange: 5
radius: 9
#displayRadius: 9
isBio: false
softCollisionOnAll: 0
disableAllUnitCollisions: true
selfBuildRate: 30s
isBuilding: false
#footprint used for collisions with units (left, up, right, down)
#footprint: -0,-0,0,0
#used for placement, and placement of other buildings
#constructionFootprint:-0,-0,0,0

#buildingToFootprintOffsetX:20
#buildingToFootprintOffsetY:10

#---------------------------------Added 
[hiddenAction_minesdeleteself]
autoTrigger:if self.timeAlive(laterThanSeconds=17)
deleteSelf: true
showQuickWarLogToPlayer: Landmine Malfunction - (missing components). Entity Lost. 
showQuickWarLogToPlayer_ru: Мину спиздили цыгане
showQuickWarLogToPlayer_zh: 地雷故障-(部件缺失)，实体丢失
[hiddenAction_realmine]
autoTriggerOnEvent: completeAndActive
convertTo: landmineBuilt


[placementRule_mines_own]
@define rng: 70
#anyRuleInGroup: place
searchTags: land_mines
searchDistance: ${rng}
searchTeam:any

excludeIncompleteBuildings: true
excludeNonBuildings: false
minCount: 0
maxCount: 0
blocksPlacement: true
cannotPlaceMessage: Cannot place Landmine within ${rng} range
cannotPlaceMessage_zh: 不能在${rng}范围内放置地雷
checkEachTile: true
[hiddenAction_clearWaypoint]
autoTriggerOnEvent: newWaypointGivenByPlayer
clearActiveWaypoint: true
#---------------------------------END 
[hiddenAction_BuildOFf]
autoTriggerOnEvent: created
requireConditional: if numberOfUnitsInTeam(greaterThan=0, withTag='lds', withinRange= 70, incompleteBuildings=true)
deleteSelf: true
addResources: ${core.price}
showMessageToPlayer: Cannot place here!
showMessageToPlayer_ru: Здесь нельзя поместить мину!
showMessageToPlayer_zh: 不能放置在此处!

[action_autoOff]
text: Disable AutoDetonate
description: - Turns off auto detonation when units get in range\n- Useful when using remote detonation\n- Takes 10 seconds
text_ru: Ручная Детонация
description_ru: - Отключает автоматическое срабатывание и принуждает активировать мину вручную
text_zh: 启用自动引爆
description_zh: -当单位进入范围时自动引爆\n-需要10秒时间
convertTo: landmineOff
displayType: upgrade
isGuiBlinking: true
buildSpeed: 2s

[action_RemoteDetonate]
text: Remote Detonate
description: - Explodes land mines remotely \n- Will automatically explode when in close proximity
text_zh: 远程引爆
description_zh: -远程爆炸地雷\n-近距离时会自动爆炸
displayType: action
pos: 1
isGuiBlinking: true
isVisible: false

# WOULD ADJUST WITHRANGE=800 TO WHATEVER
autoTrigger: if numberOfUnitsInTeam(greaterThan=0, withTag='Explode', withinRange=800)
isLocked: false
fireTurretXAtGround: 1

########################################### diffused
[hiddenAction_diffusedLandmind]
autoTriggerOnEvent: newMessage(withTag="diffuseLandmine")
deleteSelf: true
addResources: hp=-${core.maxHp}
spawnEffects:CUSTOM:diffLM
[effect_diffLM]
xOffsetRelative:0
yOffsetRelative:0
priority:critical
image:ROOT:data\images\YouMad.png
life: 500
fadeOut: true
dirOffsetRandom: 180
attachedToUnit: false
color: #ffffff
fadeInTime: 1
scaleFrom: 0.35
scaleTo: 0.35
alpha: 2
createWhenOverLiquid: false
drawUnderUnits: true
###########################################

[hiddenAction_ShowLandMines]
text: hiddenAction_ShowLandMines
description: - Shows the location of landmines when engineer is within range
spawnEffects:CUSTOM:mineFlare
# WOULD ADJUST WITHRANGE=800 TO WHATEVER
autoTrigger: if numberOfUnitsInEnemyTeam(greaterThan=0, withTag='Engineer', withinRange=800)


# MUST MATCH ACTION REMOTE DET RANGE
[turret_RemoteRangeUI]
x:0
y:0
turnSpeed: 0
limitingRange: 800
showRangeUIGuide: true

# MUST MATCH ACTION DISARM RANGE
[turret_DisarmRangeUI]
x:0
y:0
turnSpeed: 0
limitingRange: 360
showRangeUIGuide: true


[graphics]
total_frames: 4
icon_zoomed_out: mine_on.png
image:      simple_mine.png
image_wreak:  NONE
image_turret: NONE

image_shadow: AUTO
shadowOffsetX:1
shadowOffsetY:1

animation_idle_start:0
animation_idle_end: 3
animation_idle_speed: 6
#animation_idle_pingPong: true

isVisibleToEnemies: false

[attack]
dieOnAttack: true
isMelee: true
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false

turretSize: 20
turretTurnSpeed: 15

maxAttackRange: 70
shootDelay: 1

[turret_1]
invisible: true
x: 0
y: 0
idleDir:0
canAttackFlyingUnits: false
canAttackLandUnits:   true
canAttackUnderwaterUnits: false
limitingRange: 70
showRangeUIGuide: true
projectile: 1
size: 1.1
turnSpeed: 15
canShoot: true

[projectile_1]
directDamage: 0
life: 1
instant: true
frame: 15
areaRadius: 200
areaDamage: 600

largeHitEffect: true
#targetGround: true

[movement]
movementType: LAND
moveSpeed: 0
moveAccelerationSpeed: 0
moveDecelerationSpeed: 0

targetHeight: -3
targetHeightDrift: 0

maxTurnSpeed: 0
turnAcceleration: 0

moveSlidingMode :false
moveIgnoringBody:false



